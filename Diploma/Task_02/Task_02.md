## Дипломный практикум в Yandex.Cloud


### Цели:

1. Подготовить облачную инфраструктуру на базе облачного провайдера Яндекс.Облако.
2. Запустить и сконфигурировать Kubernetes кластер.
3. Установить и настроить систему мониторинга.
4. Настроить и автоматизировать сборку тестового приложения с использованием Docker-контейнеров.
5. Настроить CI для автоматической сборки и тестирования.
6. Настроить CD для автоматического развёртывания приложения.

### Этапы выполнения:
#### Создание облачной инфраструктуры
Для начала необходимо подготовить облачную инфраструктуру в ЯО при помощи Terraform.

Особенности выполнения:

* Бюджет купона ограничен, что следует иметь в виду при проектировании инфраструктуры и использовании ресурсов; Для облачного k8s используйте региональный мастер(неотказоустойчивый). Для self-hosted k8s минимизируйте ресурсы ВМ и долю ЦПУ. В обоих вариантах используйте прерываемые ВМ для worker nodes.
* Следует использовать версию Terraform не старше 1.5.x .

Предварительная подготовка к установке и запуску Kubernetes кластера.

* Создайте сервисный аккаунт, который будет в дальнейшем использоваться Terraform для работы с инфраструктурой с необходимыми и достаточными правами. Не стоит использовать права суперпользователя
  * Note for my: сервисный аккаунт (sun) завел через UI 
* Подготовьте backend для Terraform: а. Рекомендуемый вариант: S3 bucket в созданном ЯО аккаунте(создание бакета через TF) б. Альтернативный вариант: Terraform Cloud
  * решение: сделал с через TF S3 bucket
  * 01: ![01](img/01.png)
  * 02: ![02](img/02.png)
  * ссылка на bucket.tf - 
  * сделал backend в S3 bucket, созданном ЯО аккаунте
  * 03: ![03](img/03.png)
  * 04: ![04](img/04.png)
  * ссылка на backend.tf - 
* Создайте VPC с подсетями в разных зонах доступности.
  * решение:
  * 05: ![05](img/05.png)
  * 06: ![06](img/06.png)
* Убедитесь, что теперь вы можете выполнить команды terraform destroy и terraform apply без дополнительных ручных действий.
  * решение:
  * 07: ![07](img/07.png)
  * 08: ![08](img/08.png)
  * ссылка на main.tf -  
* В случае использования Terraform Cloud в качестве backend убедитесь, что применение изменений успешно проходит, используя web-интерфейс Terraform cloud.

Ожидаемые результаты:

* Terraform сконфигурирован и создание инфраструктуры посредством Terraform возможно без дополнительных ручных действий.
* Полученная конфигурация инфраструктуры является предварительной, поэтому в ходе дальнейшего выполнения задания возможны изменения.

#### Создание Kubernetes кластера

Ожидаемый результат:

* Работоспособный Kubernetes кластер.
* В файле ~/.kube/config находятся данные для доступа к кластеру.
* Команда kubectl get pods --all-namespaces отрабатывает без ошибок.
  * решение: воспользовался, пакетом Kubespray
  * 09: ![09](img/09.png)

#### Создание тестового приложения

Ожидаемый результат:

* Git репозиторий с тестовым приложением и Dockerfile.
* Регистри с собранным docker image. В качестве регистри может быть DockerHub или Yandex Container Registry, созданный также с помощью terraform.
  * решение:
  * ссылка на Git репозиторий с тестовым приложением и Dockerfile - https://github.com/staratel74/nginx-repo/tree/main
  * ссылка на регистри с собранным docker image - https://hub.docker.com/repository/docker/staratel/nginx-repo/general

#### Подготовка cистемы мониторинга и деплой приложения

Цель:

* Задеплоить в кластер prometheus, grafana, alertmanager, экспортер основных метрик Kubernetes.
* Задеплоить тестовое приложение, например, nginx сервер отдающий статическую страницу.
  * решение:
  * 10: ![10](img/10.png)
  * 11: ![11](img/11.png)
  * 12: ![12](img/12.png)
  * 13: ![13](img/13.png)

#### Установка и настройка CI/CD

Цель:

* Автоматическая сборка docker образа при коммите в репозиторий с тестовым приложением.
* Автоматический деплой нового docker образа.
  * решение: использовал Jenkins
  * 14: ![14](img/14.png)
  * Отредактировал index.html, прописал - Hello! This is my diploma v1.10.0 Сделал коммит, запушил в репозиторий https://github.com/staratel74/nginx-repo В Jenkins запустилась job Diploma_Pipeline, отработал pipeline. 
  * Ссылка на JenkinsConsoleOutput.txt -  
  * 15: ![15](img/15.png)
  * 16: ![16](img/16.png)

## END